<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Cat and Mouse</title>
</head>
<body onkeydown="game.eat(event)">
<canvas id="catCanvas" width="1080" height="768" style="border: 1px solid #2196F3"></canvas>
<script>

    const ORIENTATION_LEFT = "left";
    const ORIENTATION_RIGHT = "right";
    const ORIENTATION_UP = "up";
    const ORIENTATION_DOWN = "down";

    const DEFAULT_CAT_X_POSITION = 100;
    const DEFAULT_CAT_Y_POSITION = 100;

    const IMAGE_WIDTH = 59;
    const IMAGE_HEIGHT = 86;

    const DEFAULT_MOUSE_X_POSITION = 400;
    const DEFAULT_MOUSE_Y_POSITION = 300;

    const DEFAULT_CAT_ORIENTATION = ORIENTATION_DOWN;
    const DEFAULT_CAT_SPEED = 20;

    const GAMEBOARD_WIDTH = 1080;
    const GAMEBOARD_HEIGHT = 768;

    function Mouse(weight) {
        this.xPosition = DEFAULT_MOUSE_X_POSITION;
        this.yPosition = DEFAULT_MOUSE_Y_POSITION;
        this.orientation = DEFAULT_CAT_ORIENTATION;
        this.speed = DEFAULT_CAT_SPEED/2;
        this.weight = weight;
        this.step = 1;

        this.move = function () {
            switch (this.orientation) {
                case ORIENTATION_DOWN:
                    this.yPosition += this.speed;
                    break;
                case ORIENTATION_RIGHT:
                    this.xPosition += this.speed;
                    break;
                case ORIENTATION_LEFT:
                    this.xPosition -= this.speed;
                    break;
                case ORIENTATION_UP:
                    this.yPosition -= this.speed;
                    break;
            }
        };

        this.show = function (ctx) {
            let xPosition = this.xPosition;
            let yPosition = this.yPosition;
            let image = new Image();
            image.src = "Image/down1.png";
            image.onload = function () {
                ctx.drawImage(image, xPosition, yPosition);
            }
        }
    }

    function Cat(weight) {
        this.xPosition = DEFAULT_CAT_X_POSITION;
        this.yPosition = DEFAULT_CAT_Y_POSITION;
        this.orientation = DEFAULT_CAT_ORIENTATION;
        this.speed = DEFAULT_CAT_SPEED;
        this.step = 1;

        this.weight = weight;

        this.show = function (ctx) {
            let image = new Image();
            let xPosition = this.xPosition;
            let yPosition = this.yPosition;
            image.src = "Image/up1.png";
            image.onload = function () {
                ctx.drawImage(image, xPosition, yPosition);
            }
        };

        this.move = function () {
            switch (this.orientation) {
                case ORIENTATION_DOWN:
                    this.yPosition += this.speed;
                    break;
                case ORIENTATION_RIGHT:
                    this.xPosition += this.speed;
                    break;
                case ORIENTATION_LEFT:
                    this.xPosition -= this.speed;
                    break;
                case ORIENTATION_UP:
                    this.yPosition -= this.speed;
                    break;
            }
        }
    }

    function GameBoard() {
        this.cat = new Cat(2);
        this.mouse = new Mouse(1);
        this.ctx = undefined;

        this.start = function () {
            this.ctx = document.getElementById("catCanvas").getContext("2d");
            this.cat.show(this.ctx);
            this.mouse.show(this.ctx);
        };

        this.render = function () {
            this.ctx.clearRect(0, 0, GAMEBOARD_WIDTH, GAMEBOARD_HEIGHT);
            this.cat.show(this.ctx);
            this.mouse.show(this.ctx);
        };

        this.gameReset = function () {
            this.cat.xPosition = DEFAULT_CAT_X_POSITION;
            this.cat.yPosition = DEFAULT_CAT_Y_POSITION;
            this.mouse.xPosition = DEFAULT_MOUSE_X_POSITION;
            this.mouse.yPosition = DEFAULT_MOUSE_Y_POSITION;
            this.cat.weight = 2;
            this.mouse.weight = 1;
        };


        this.checkEat = function () {
            let minusXMouse = this.mouse.xPosition - 40;
            let xMousePosition = this.mouse.xPosition + 40;
            let yMousePosition = this.mouse.yPosition + 40;
            let minusYMouse = this.mouse.yPosition - 40;
            if (this.cat.xPosition >= minusXMouse && this.cat.xPosition <= xMousePosition && this.cat.yPosition >= minusYMouse && this.cat.yPosition <= yMousePosition) {
                this.cat.weight += 1;
                this.mouse.weight -= 1;
                console.log(this.cat.weight);
                console.log(this.mouse.weight);
                if (this.mouse.weight === 0) {
                    alert("die");
                    this.gameReset();
                }
            }
        };

        this.eat = function (event) {
            let orientation = 0;
            switch (event.which) {
                case 37:
                    orientation = ORIENTATION_LEFT;
                    break;
                case 38:
                    orientation = ORIENTATION_UP;
                    break;
                case 39:
                    orientation = ORIENTATION_RIGHT;
                    break;
                case 40:
                    orientation = ORIENTATION_DOWN;
                    break;
            }
            if (orientation) {
                if (this.cat.orientation !== orientation) {
                    this.cat.orientation = orientation;
                    this.mouse.orientation = orientation;
                } else {
                    this.cat.move();
                    this.mouse.move();
                }
                this.checkEat();
                this.render();
            }
        }
    }

    let game = new GameBoard();
    game.start();
</script>
</body>
</html>